# HC4シリーズ ユーザーズマニュアル ハードウェア編

## 概要

- 教育用のローコスト4bit CPU
- 演算スタックモデルを採用
- シンプルな構造によりローコストを実現
- Verilogによる実装、汎用ロジックICによる実装がある
- ハーバードアーキテクチャを使用（プログラム:8bit\*4096、データ:4bit\*256）
- 演算スタックモデルを使用

## 1.もくじ

## 2.内部構造

### 2.1.全体ブロック図

![Block diagram of this CPU.](./HC4.svg)

#### 2.1.1.ALU

このCPUはALU(Arithmetic Logic Unit, 算術論理ユニット)ですべての演算を行う。
ALUはAND,OR,XOR,加算,減算の演算に対応しており、ソースに演算スタックAとBをとり、結果をデータバスに出力する。
また、演算スタックAをデータバスに出力するときにも使用する。\
\
関連する信号線:
- STACK-A[3:0]
- STACK-B[3:0]
- DATABUS[3:0]
- Carry-IN
- Carry-OUT

#### 2.1.2.データバス、アドレスバス

データバス、アドレスバスはCPUとRAMやI/Oなどを相互に接続する。
データバスは4bit、アドレスバスは8bitである。よって、メモリ空間は4bit*256である。
このCPUはメモリマップドI/Oを使用するため、すべてのI/O機器はアドレスバス、データバスに接続しなければならない。
アドレスの割り当ては基本的に自由だが、0x00~0x0Fまではレジスタ領域として予約されているため、必ずRAMを配置しなければならない。\
\
関連する信号線:
- DATA-BUS[3:0]
- ADDRESS-BUS[7:0]
- nWR
- nRD

#### 2.1.3.演算スタック

演算スタックはほぼすべての命令のオペランドとして暗黙的に使用される。
演算スタックはLIFO構造であり（つまりスタックではなくキューであり）、```LD```, ```LI```命令で値をロードする。
演算スタックはA, B, Cの3レベルを持ち、ロードされたデータは初めにレベルAに入る。
レベルAの入力はデータバスに接続されている。
演算スタックがロードされたとき、レベルCにあったデータは消失する。
各命令ごとの演算スタックの動作やとるオペランドについては、ユーザーズマニュアル ソフトウェア編を参照されたし。

#### 2.1.4.プログラムカウンタ

プログラムカウンタ(PC)は12bit幅のレジスタであり、現在実行中の命令のアドレスが格納されている。
プログラムカウンタはCLKの立ち上がりエッジでインクリメントされる。つまり、毎回の命令実行が終わったときにインクリメントされる。
ジャンプ命令（```JP```）が実行されたとき、PCの値はスタックのA,B,Cの値に書き換えられる。

#### 2.1.5.命令デコーダ

命令デコーダは、命令の種類に応じて、CPUの各部に制御信号を供給する。
この部分の構造は実装によって左右される。
